/*---------------------------------------------------------------*/
/*  Device / run-time headers                                    */
/*---------------------------------------------------------------*/
#include "devscc.h"
#include "sf-types.h"
#include "sh7708.h"
#include "e-types.h"
#include <stdint.h>

#define ITER 256                 /* CORDIC iteration depth */

/*---------------------------------------------------------------*/
/*  main – all logic in one place                                */
/*---------------------------------------------------------------*/
int main(void)
{
    /*-----------------------------------------------------------*/
    /*  LED MMIO pointer                                         */
    /*-----------------------------------------------------------*/
    volatile unsigned int * const gLEDs = (unsigned int *)0x2000;

    /*-----------------------------------------------------------*/
    /*  Angle table & result buffers                             */
    /*-----------------------------------------------------------*/

    int32_t angle_list[] = {
    0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0xAAAAAAA1,
    0xB0000000, 0xB5555555, 0xBAAAAAAA, 0xC0000000,
    0xC5555555, 0xCAAAAAAA, 0xD0000000, 0xD5555555,
    0xDAAAAAAA, 0xE0000000, 0xE5555555, 0xEAAAAAAA,
    0xF0000000, 0xF5555555, 0xFAAAAAAA, 0xFFFFFFFF,
    0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0xAAAAAAA1,
    0xB0000000, 0xB5555555, 0xBAAAAAAA, 0xC0000000,
    0xC5555555, 0xCAAAAAAA, 0xD0000000, 0xD5555555,
    0xDAAAAAAA, 0xE0000000, 0xE5555555, 0xEAAAAAAA,
    0xF0000000, 0xF5555555, 0xFAAAAAAA, 0xFFFFFFFF,
    0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0xAAAAAAA1,
    0xB0000000, 0xB5555555, 0xBAAAAAAA, 0xC0000000,
    0xC5555555, 0xCAAAAAAA, 0xD0000000, 0xD5555555,
    0xDAAAAAAA, 0xE0000000, 0xE5555555, 0xEAAAAAAA,
    0xF0000000, 0xF5555555, 0xFAAAAAAA, 0xFFFFFFFF,
    0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0xAAAAAAA1,
    0xB0000000, 0xB5555555, 0xBAAAAAAA, 0xC0000000,
    0xC5555555, 0xCAAAAAAA, 0xD0000000, 0xD5555555,
    0xDAAAAAAA, 0xE0000000, 0xE5555555, 0xEAAAAAAA,
    0xF0000000, 0xF5555555, 0xFAAAAAAA, 0xFFFFFFFF,
    0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0xAAAAAAA1,
    0xB0000000, 0xB5555555, 0xBAAAAAAA, 0xC0000000,
    0xC5555555, 0xCAAAAAAA, 0xD0000000, 0xD5555555,
    0xDAAAAAAA, 0xE0000000, 0xE5555555, 0xEAAAAAAA,
    0xF0000000, 0xF5555555, 0xFAAAAAAA, 0xFFFFFFFF,
    0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0xAAAAAAA1,
    0xB0000000, 0xB5555555, 0xBAAAAAAA, 0xC0000000,
    0xC5555555, 0xCAAAAAAA, 0xD0000000, 0xD5555555,
    0xDAAAAAAA, 0xE0000000, 0xE5555555, 0xEAAAAAAA,
    0xF0000000, 0xF5555555, 0xFAAAAAAA, 0xFFFFFFFF,
    0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0xAAAAAAA1,
    0xB0000000, 0xB5555555, 0xBAAAAAAA, 0xC0000000,
    0xC5555555, 0xCAAAAAAA, 0xD0000000, 0xD5555555,
    0xDAAAAAAA, 0xE0000000, 0xE5555555, 0xEAAAAAAA,
    0xF0000000, 0xF5555555, 0xFAAAAAAA, 0xFFFFFFFF,
    0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 0xAAAAAAA1,
    0xB0000000, 0xB5555555, 0xBAAAAAAA, 0xC0000000,
    0xC5555555, 0xCAAAAAAA, 0xD0000000, 0xD5555555,
    0xDAAAAAAA, 0xE0000000, 0xE5555555, 0xEAAAAAAA,
    0xF0000000, 0xF5555555, 0xFAAAAAAA, 0xFFFFFFFF,
    0x00000000, 0x0AAAAAAA, 0x10000000, 0x15555555,
    0x1AAAAAAA, 0x20000000, 0x25555555, 0x2AAAAAAA,
    0x30000000, 0x35555555, 0x3AAAAAAA, 0x40000000,
    0x45555555, 0x4AAAAAAA, 0x50000000, 0x55555555,
    0x5AAAAAAA, 0x60000000, 0x65555555, 0x6AAAAAAA,
    0x70000000, 0x75555555, 0x7AAAAAAA, 0x80000000,
    0x85555555, 0x8AAAAAAA, 0x90000000, 0x95555555,
    0x9AAAAAAA, 0xA0000000, 0xA5555555, 
    /* The above angles are in Q1.31 format, representing
       0° to 360° in increments of 11.25° (or π/16 radians).
       The last value is a special case for the CORDIC algorithm.
       Adjust the list as needed for your application. */
    /* … */
    };
    int NUM_ANGLES = sizeof(angle_list) / sizeof(angle_list[0]);

    /* handy pattern values – anything non-zero works */
    int32_t sin_results[NUM_ANGLES];   /* zero-init in .bss */
    int32_t cos_results[NUM_ANGLES];   /* zero-init in .bss */



    /*-----------------------------------------------------------*/
    /*  Fixed-point arctangent table (Q1.31)                     */
    /*-----------------------------------------------------------*/
    static const int32_t atan_tbl[ITER] = {
        0x3243F6A9, 0x1DAC6705, 0x0FADBAFC, 0x07F56EA6,
        0x03FAB9F6, 0x01FD5BA9, 0x00FFAAAD, 0x007FF556,
        0x003FFEAB, 0x001FFFD5, 0x000FFFFE, 0x0007FFFF,
        0x0003FFFF, 0x0001FFFF, 0x0000FFFF, 0x00007FFF,
        0x00003FFF, 0x00001FFF, 0x00000FFF, 0x000007FF,
        0x000003FF, 0x000001FF, 0x000000FF, 0x0000007F,
        0x0000003F, 0x0000001F, 0x0000000F, 0x00000007,
        0x00000003, 0x00000001, 0x00000000
    };

    /*-----------------------------------------------------------*/
    /*  LED blink – program start                                */
    /*-----------------------------------------------------------*/
    *gLEDs = 0xFF;    /* on  */
    *gLEDs = 0x00;    /* off */

    /*-----------------------------------------------------------*/
    /*  CORDIC sweep – no helper function                        */
    /*-----------------------------------------------------------*/
    for (int a = 0; a < NUM_ANGLES; ++a)
    {
        int32_t x = 0x4DBA76D4;       /* K31 = 0.607252935 (Q1.31) */
        int32_t y = 0;
        int32_t z = angle_list[a];

        for (int i = 0; i < ITER; ++i)
        {
            int32_t dx = y >> i;
            int32_t dy = x >> i;

            if (z >= 0)
            {
                x -= dx;
                y += dy;
                z -= atan_tbl[i];
            }
            else
            {
                x += dx;
                y -= dy;
                z += atan_tbl[i];
            }
        }

        cos_results[a] = x;
        sin_results[a] = y;

    }

    /*-----------------------------------------------------------*/
    /*  Finished – solid LED and idle loop                       */
    /*-----------------------------------------------------------*/
    *gLEDs = 0xFF;
    while (1) { 
    }     /* keep hardware alive */

    return 0;
}
